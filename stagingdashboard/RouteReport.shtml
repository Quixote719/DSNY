<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/dsny/stagingbulkdashboard/includes/css/bootstrap.min.css">
	<link rel="stylesheet" href="/assets/dsny/stagingbulkdashboard/includes/css/application.css">
    <style type="text/css">
		@page { margin: 0; }

		@media print {
			@page { margin: 0;  size: landscape; font-size:10px !Important;}
			body { margin: 0;font-size:10px !Important; font-family: Calibri, sans-serif;}
		}

        body {
            max-width: 100%;
            font-family:  Calibri, sans-serif;;
            font-weight: 300;
        }

        .gtxt{
          color:#666666;
        }

        .gap{
            margin:4px  0px;
            padding: 0px 15px;
        }
        .row{
         margin-left: 0px;
         margin-right: 0px;
        }

        table
        {
            padding: 0px;
            margin: 0px;
			      height: 0px !important
        }

        .border{
            border-bottom:2px solid #cbcbcb;
            padding: 4px 0px;
            background-color:white;
            margin: 0px;
        }

        .bold{
            font-weight:bold;
        }

        .gray{
            background-color:#dbdbdb !important;
        }

        .lgray{
            background-color:#ffffff !important;
        }

        .comments{
            background-color:white !important;
            float:left;
        }

        .rowItem{
            background-color:white !important;
            border-right:2px solid #dbdbdb;
        }
        .lgrey{
            background-color:#f0f0f0 !important;
        }
        .bottomLine{
          border-bottom: 2px #dbdbdb
        }

    </style>
	<script type="text/javascript">

        if (location.href.indexOf("https://") == -1) {
            location.href = location.href.replace("http://", "https://");
        }

	</script>
</head>
<body style="-webkit-print-color-adjust: exact;font-family:  Calibri, sans-serif; font-size:16px;" >
    <nav class="navbar navbar-full bgcolor">
        <div class="navbar-brand navbar-margin">
            <div class="navbar-div">
                <span><b class="navbar-div bold">Bulk</b></span>
            </div>
            <div class="navbar-div">
                <span><p class="navbar-div">PICK UP</p></span>
            </div>
        </div>
        <form class="form-inline pull-xs-right">
            <button id="btnback" class="btn navButton" type="submit" onmouseover="this.style.background='#0d8219';" onmouseout="this.style.background='#0e8c1b';">Back to Dashboard</button>
            <button class="btn logoutButton" type="submit">Logout</button>
        </form>
    </nav>
    <div class="container-fluid FirstRow" style="width:98%">
        <div class="divPrint" style="text-align:center">
              <table style="padding:0px;">
                  <th style="font-size:12pt; font-color:#4A4A4A; line-height:26px; padding-top: 10px; padding-bottom: 5px; font-weight:bold"> <b>Route Report: </b> <label id='lblDate' for="ScheduledDate"></label> </th>
                  <th style="font-size:12pt; font-color:#4A4A4A; line-height:26px; padding-top: 10px; padding-bottom: 5px; text-align:right;"><span id="printlink"><i class="fa fa-print" style="color:&#xf02f"></i> <a id="btnprint" href="" style="color: #006646; text-decoration: underline"> Print this page</a></span></th>
              </table>
        </div>
    </div>

    <div id="Injected">        </div>

        <!-- jQuery first, then Tether, then Bootstrap JS.-->
        <script src="/assets/dsny/stagingdashboard/includes/js/jquery.min.js"></script>
        <script src="/assets/dsny/js/webforms/jquery.xdomainrequest.js" type="text/javascript"></script>
        <script src="/assets/dsny/stagingdashboard/includes/js/tether.min.js"></script>
        <script src="/assets/dsny/stagingdashboard/includes/js/bootstrap.min.js"></script>
        <script src="/assets/dsny/js/webforms/stagingConfig.js" type="text/javascript"></script>
        <script type="text/javascript">
            //var APIUrl = 'http://localhost:36186';
            //var APIUrl = 'https://msswvw-dnsdnyvp.csc.nycnet';
            //var APIUrl = 'https://msdwvw-dsndny01.csc.nycnet';

            function capChars(string) {
                return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
            }

            var SearchDate = sessionStorage.getItem("pickupdate");
            var Borough = sessionStorage.getItem("borough");
            var DistrictId = sessionStorage.getItem("district");
            var TruckId = 0;

            if (sessionStorage.getItem("truckId") != undefined)
                TruckId = sessionStorage.getItem("truckId");

            $(document).ready(function () {

                jQuery.support.cors = true;
                $("#printlink").show();
                $("#lblDate").text(SearchDate);

                var RequestUrl = APIUrl + '/ePickupsAPI/api/BulkPickups/GetRouteReport?district=' + DistrictId +'&searchDate='+ SearchDate;

                $.ajax({
                    async: false,
                    url: RequestUrl,
                    type: 'GET',
                    dataType: 'json',
                    crossDomain: true,
                    success: function (data) {
                        if ( data == null || data[0].Requests ==  null)
                        {
                              $("#Injected").append('<div class="container-fluid bold" style="width:98%;color:red;">There is no available data for the selected parameters</div>');
                        }
                        else{
                        $.each(data, function (i, item) {

                            var reportFull = '   <div class="container-fluid " style="width:98%; padding:0px 10px;">';

                            var struct = '<div id="divborder" >'
                                        + '<div class="gap border" style="border:0px">'
                                            + '<div class="row gray" style="padding-top:10px;">'
                                                + '<div class="col-sm-2 gtxt">District</div>'
                                                + '<div class="col-sm-2"></div>'
                                                + '<div class="col-sm-2 gtxt" style="text-align:center">Total Assignments</div>'
                                                + '<div class="col-sm-2 gtxt" style="text-align:center">Total Routed Stops</div>'
                                                + '<div class="col-sm-2 gtxt" style="text-align:center">Total Items</div>'
                                                + '<div class="col-sm-2 gtxt" style="text-align:center">Total Mileage</div>'
                                            + '</div>'
                                            + '<div class="row gray bold" style="padding-bottom:10px;">'

                                                + '<div class="col-sm-2">' + item.DistrictName + '</div>'
                                                + '<div class="col-sm-2"></div>'
                                                + '<div class="col-sm-2" style="text-align:center">' + item.TotalAssignments + '</div>'
                                                + '<div class="col-sm-2" style="text-align:center">' + item.TotalStops + '</div>'
                                                + '<div class="col-sm-2" style="text-align:center">' + item.TotalItems + '</div>'
                                                + '<div class="col-sm-2" style="text-align:center">' + item.Mileage + '</div>'

                                            + ' </div>'
                                        + '</div>'
                                        + '<div class="gap border lgrey" style="padding:10px 0px 0px 0px;border-bottom:2px solid black;">'
                                            + '<div class="row ">'
                                                + '<div class="col-sm-1 bold" style="width:3%">Stop </div>'
                                                + '<div class="col-sm-1 bold" style="width:4%">Section </div>'
                                                + '<div class="col-sm-1 bold" style="width:10%">Address </div>'
                                                + '<div class="col-sm-1 bold" style="width:9%">Pickup Street </div>'
                                                + '<div class="col-sm-1 bold" style="width:16%">Cross Streets </div>'
                                                + '<div class="col-sm-1 bold" style="width:9%">Location</div>'
                                                + '<div class="col-sm-1 bold" style="width:7%">Frequency</div>'
                                                + '<div class="col-sm-1 bold" style="width:9%">SR# </div>'
                                                + '<div class="col-sm-3 bold" style="width:23%">Items </div>'
                                                + '<div class="col-sm-1 bold" style="width:10%">Picked Up?</div>'
                                            + '</div>'
                                        + '</div>'
                                        + '<div class="gap border" style="border:0px">';
                                var struct3 = '';
                                $.each(item.Requests, function (j, item2) {

                                    var struct4 = '';

                                    $.each(item2.RequestItems, function (j, item3) {
                                      struct4+=  '<b class="bold">' +item3.RequestedQty + '</b> '  + item3.Category + ', ';
                                    });

                                    struct3 += '<div class="row border"><div class="col-sm-1 "  style="width:3%">' + item2.WayPointOrder + '</div>'
                                    + '<div class="col-sm-1 " style="width:4%">' + item2.Section + '</div>'
                                    // + '<div class="col-sm-1 "><div class="row bold">' + item2.Street + '</div> <div class="row">'+ item2.BldgNo+ ' ' + item2.Street + '</div> <div class="row ">(' + item2.CrossStreets + ')</div> </div>'
                                    // + '<div class="col-sm-1 "><div class="row bold">' + item2.Street + '</div> <div class="row">'+ item2.BldgNo+ ' ' + item2.Street + '</div> <div class="row ">(' + item2.CrossStreets + ')</div> </div>'
                                    + '<div class="col-sm-1 " style="width:10%">' + item2.BldgNo+ ' ' + capChars(item2.Street)  + '</div>'
                                    + '<div class="col-sm-1 " style="width:9%">' + capChars(item2.Street)  + '</div>'
                                    + '<div class="col-sm-1 " style="width:16%">' + capChars(item2.CrossStreets)  + '</div>'
                                    + '<div class="col-sm-1 " style="width:9%">' + capChars(item2.PickupLocation) + '</div>'
                                    + '<div class="col-sm-1 " style="width:7%">' + item2.Frequency + '</div>'
                                    + '<div class="col-sm-1 " style="width:9%">' + item2.SRNo + '</div>'
                                    + '<div class="col-sm-3 " style="width:23%">' + struct4.slice(0, -2) + '</div>'
                                    + '<div class="col-sm-1 bold" style="width:10%">Y  NOL  Uns</div>'
                                    // + '<div class="col-sm-1 bold"><div class="row"><span class="bold">YES</span> <img src="/assets/dsny/stagingbulkdashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></div>'
                                    // + '<div class="row"><span class="bold">NOL</span>  <img src="/assets/dsny/stagingbulkdashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></div>'
                                    // + '<div class="row"><span class="bold">UNS</span>  <img src="/assets/dsny/stagingbulkdashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></div>'
                                    + '</div>';

                                    // struct4 += '<div class="row rowItem">'
                                    // + '<div class="col-sm-10">' + item2.WayPointOrder + '</div>'
                                    // + '<div class="col-sm-2 bold" style="text-align:right">' + item2.PickedUpCount + '</div>'
                                    // + '</div>';
                            });
                                    struct += struct3
                        + '</div></div>';

                            reportFull += struct;
                            $("#Injected").append(reportFull);
                        });
                      }
                    }
                });

                $("#btnback").click(function () {
                    window.location.href = "/assets/dsny/stagingdashboard/BulkIndex.shtml";
                    return false;
                });

                $('.logoutButton').click(function () {
                    sessionStorage.setItem("pickupdate", "");
                    sessionStorage.setItem("borough", "");
                    sessionStorage.setItem("district", "");
                    window.location.href = '/assets/dsny/stagingdashboard/login.shtml';
                    return false;
                });
            });


            $("#btnprint").click(function () {
                $("#printlink").hide();
                var originalContents = $("body").html();
                var printContents = $("#divPrint").html();
                $("body").html(printContents);
                window.print();
                $("body").html(originalContents);
            });

            function getParameter(paramName) {
                var searchString = window.location.search.substring(1),
                i, val, params = searchString.split("&");
                for (i = 0; i < params.length; i++) {
                    val = params[i].split("=");
                    if (val[0] == paramName) {
                        return val[1];
                    }
                }
                return null;
            }



        </script>



        <script type="text/javascript">
            jQuery(function ($) {
                $("#exportButton").click(function () {
                    // parse the HTML table element having an id=exportTable
                    var dataSource = shield.DataSource.create({
                        data: "#exportTable",
                        schema: {
                            type: "table",
                            fields: {
                                Name: { type: String },
                                Age: { type: Number },
                                Email: { type: String }
                            }
                        }
                    });

                    // when parsing is done, export the data to Excel
                    dataSource.read().then(function (data) {
                        new shield.exp.OOXMLWorkbook({
                            author: "PrepBootstrap",
                            worksheets: [
                                {
                                    name: "PrepBootstrap Table",
                                    rows: [
                                        {
                                            cells: [
                                                {
                                                    style: {
                                                        bold: true
                                                    },
                                                    type: String,
                                                    value: "Name"
                                                },
                                                {
                                                    style: {
                                                        bold: true
                                                    },
                                                    type: String,
                                                    value: "Age"
                                                },
                                                {
                                                    style: {
                                                        bold: true
                                                    },
                                                    type: String,
                                                    value: "Email"
                                                }
                                            ]
                                        }
                                    ].concat($.map(data, function (item) {
                                        return {
                                            cells: [
                                                { type: String, value: item.Name },
                                                { type: Number, value: item.Age },
                                                { type: String, value: item.Email }
                                            ]
                                        };
                                    }))
                                }
                            ]
                        }).saveAs({
                            fileName: "PrepBootstrapExcel"
                        });
                    });
                });
            });
        </script>

        <style>
            #exportButton {
                border-radius: 0;
            }
        </style>
</body>

</html>
