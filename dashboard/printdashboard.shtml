<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/dsny/dashboard/includes/css/bootstrap.min.css">
	<link rel="stylesheet" href="/assets/dsny/dashboard/includes/css/application.css">
	<link rel="stylesheet" href="/assets/dsny/dashboard/includes/css/font-awesome.min.css">
    <style type="text/css">
		@page { margin: 0; }

		@media print {
			@page { margin: 0;  size: landscape;}
			body { margin: 1.6cm; }
		}

        table {
            width: 100%;
            padding: 0px;
            margin: 0px;
			height: 0px !important
        }
        th {
			padding: 0px;
            text-align: left;
        }
		td{
            text-align: left;
		}
    </style>
	<script type="text/javascript">

			if (location.href.indexOf("https://") == -1) {
				location.href = location.href.replace("http://", "https://");
			}

	</script>
</head>
<body style="-webkit-print-color-adjust: exact;">
    <nav class="navbar navbar-full bgcolor">
        <div class="navbar-brand navbar-margin">
            <div class="navbar-div">
                <span><b class="navbar-div">e-waste</b></span>
            </div>
            <div class="navbar-div">
                <span><p class="navbar-div">PICK UP</p></span>
            </div>
        </div>
        <form class="form-inline pull-xs-right">
            <button id="btnback" class="btn navButton" type="submit" onmouseover="this.style.background='#0d8219';" onmouseout="this.style.background='#0e8c1b';">Back to Dashboard</button>
            <button class="btn logoutButton" type="submit">Logout</button>
        </form>
    </nav>

    <div class="container-fluid FirstRow">
		<div class="divPrint" style="text-align:center">
			<table id="tblReport">
				<tr>
					<td>
						<table style="padding:0px;">
							<th style="font-size:12pt; font-color:#4A4A4A; line-height:26px; padding-top: 20px; padding-bottom: 10px"> Scheduled Date: <label id='lblDate' for="ScheduledDate"></label> </th>
							<th style="font-size:12pt; font-color:#4A4A4A; line-height:26px; padding-top: 20px; padding-bottom: 10px; text-align:right;"><span Id="printlink"><i class="fa fa-print" style="color:&#xf02f"></i> <a id="btnprint" href="" style="color: #006646; text-decoration: underline"> Print this page</a></span></th>
						</table>
					</td>
				</tr>
			</table>
        </div>
    </div>
    <!-- jQuery first, then Tether, then Bootstrap JS.-->
    <script src="/assets/dsny/dashboard/includes/js/jquery.min.js"></script>
	<script src="/assets/dsny/js/webforms/jquery.xdomainrequest.js" type="text/javascript"></script>
	<script src="/assets/dsny/dashboard/includes/js/tether.min.js"></script>
    <script src="/assets/dsny/dashboard/includes/js/bootstrap.min.js"></script>
	<!--<script src="/assets/dsny/js/webforms/stagingConfig.js" type="text/javascript"></script>-->
		<script src="/assets/dsny/js/webforms/production_staging_config.js" type="text/javascript"></script>
    <script type="text/javascript">
	//var APIUrl = 'https://msdwvw-dsndny01.csc.nycnet';
	//var APIUrl = 'https://msswvw-dnsdnyvp.csc.nycnet';

	var SearchDate = sessionStorage.getItem("pickupdate");
    var Borough = sessionStorage.getItem("borough");
    var DistrictId = sessionStorage.getItem("district");
	var TruckId = 0;

	if(sessionStorage.getItem("truckId") != undefined)
		TruckId = sessionStorage.getItem("truckId");

	$(document).ready(function (){

		jQuery.support.cors = true;
		$("#printlink").show();
		//var TruckId = 0;

		$("#lblDate").text(SearchDate);

		var RequestUrl = APIUrl + '/ePickupsAPI/api/Dashboard/DashboardExportToExcel?SearchDate=' + SearchDate + '&Borough=' + Borough  + '&DistrictId=0&TruckId=' +  TruckId
        $.ajax({
				async: false,
				url: RequestUrl,
				type: 'GET',
				dataType: 'json',
				crossDomain: true,
				success: function (data) {
              if(data.length == 0)
              {
                  $("#tblReport").append('<div style="width:90%;color:red;">There is no available data for the selected parameters</div>');
              }
					$.each(data, function (i, pritemHeader) {
						if(i>0)
						{

							$('#tblReport').append('<tr style="height:50px"> <td> </td> </tr>');
						}
						var tbl1 = '<tr style="background-color:#DBDBDB;"> <td> <table style="padding:0px">'
										+ '<tr style="font-size:9pt; font-color:#4A4A4A;">'
											+	'<td style="width:12%; padding-left:20px; padding-bottom:0px; padding-top:15px">Truck #</td>'
											+	'<td style="width:14%; padding-bottom:0px; padding-top:15px">Supervisor</td>'
											+	'<td style="width:14%; padding-bottom:0px; padding-top:15px">San Worker</td>'
											+	'<td style="width:14%; padding-bottom:0px; padding-top:15px">San Worker</td>'
											+	'<td style="width:12%; padding-bottom:0px; padding-top:15px">&nbsp;</td>'
											+	'<td style="width:8%; text-align:center; padding-bottom:0px; padding-top:15px">LCD TVs</td>'
											+	'<td style="width:8%; text-align:center; padding-bottom:0px; padding-top:15px">CRT TVs</td>'
											+	'<td style="width:8%; text-align:center; padding-bottom:0px; padding-top:15px">Others</td>'
											+	'<td style="width:10%; text-align:center; padding-bottom:0px; padding-top:15px">Total Items</td>'
											+ '</tr>'
											+ '<tr style="font-size:10pt; font-color:#4A4A4A;font-weight: bold;">'
											+	'<th style="padding-left:20px; padding-top:0px; padding-bottom:15px">' + pritemHeader.TruckSerialNO + '</th>'
											+	'<th style="padding-top:0px; padding-bottom:15px">' + pritemHeader.Supervisor + '</th>'
											+	'<th style="padding-top:0px; padding-bottom:15px">' + pritemHeader.SanWorer1  + '</th>'
											+	'<th style="padding-top:0px; padding-bottom:15px">' + pritemHeader.SanWorker2 + '</th>'
											+	'<th style="padding-top:0px; padding-bottom:15px">&nbsp;</th>'
											+	'<th style="text-align:center; padding-top:0px; padding-bottom:15px">' + pritemHeader.LCDTVs + '</th>'
											+	'<th style="text-align:center; padding-top:0px; padding-bottom:15px">' + pritemHeader.CRTTvs + '</th>'
											+	'<th style="text-align:center; padding-top:0px; padding-bottom:15px">' + pritemHeader.Others + '</th>'
											+	'<th style="text-align:center; padding-top:0px; padding-bottom:15px">' + pritemHeader.TotalItems + '</th>'
											+'</tr>'
											+ '</table> </td> </tr>'
						$('#tblReport').append(tbl1);

						var tbl2HeaderRow = '<tr> <td style="padding-top:15px"> <table id="tblrows' + i  + '">'
											+ 	'<tr style="background-color:#F5F5F5; font-color:#000000; font-size: 8pt">'
											+	'<th style="width:15%; padding-left:20px; padding-bottom:0px; padding-top: 20px">SR#</th>'
											+	'<th style="width:12%; padding-bottom:0px; padding-top: 20px ">District/Section</th>'
											+	'<th style="width:30%; padding-bottom:0px; padding-top: 20px ">Pickup Location</th>'
											+	'<th style="width:30%; padding-bottom:0px; padding-top: 20px">Items</th>'
											+	'<th style="width:3%; padding-bottom:0px; padding-top: 20px"></th>'
											+   '<th style="width:10%; text-align:center; padding-bottom:0px; padding-top: 20px">Picked Up?</th>'
											+  	'</tr>'
											+  '</table> </td> </tr>'
						$('#tblReport').append(tbl2HeaderRow);

						$.each(pritemHeader.TruckPickupRequests, function (j, pritem){
								var totalRows = pritem.PickupRequestItems.length;

								$.each(pritem.PickupRequestItems, function (k, pritemCat){
											var tbl2Row ;
											var tblCellCategory;
											if( (pritemCat.CategoryId  == 1) || (pritemCat.CategoryId == 17))
											{
												if(k==0)
												{
													tblCellCategory = '<td style="font-weight:bold; padding-top: 15px">' + pritemCat.Category + '</td>'
												}
												else if(k == (totalRows-1))
												{
													tblCellCategory = '<td style="font-weight:bold; padding-bottom: 15px">' + pritemCat.Category + '</td>'
												}
												else
												{
													tblCellCategory = '<td style="font-weight:bold;">' + pritemCat.Category + '</td>'
												}

											}
											else
											{
												if(k == (totalRows-1))
												{
													tblCellCategory = '<td style="padding-bottom: 15px">' + pritemCat.Category + '</td>'
												}
												else
												{
													tblCellCategory = '<td>' + pritemCat.Category + '</td>'
												}
											}

											if(k == 0)
											{
												if(totalRows >= 2)
												{
													tbl2Row = '<tr style="border-top: 2px solid #D5D5D6; font-size: 9pt">'
															+ 	'<td style="padding-left:20px; ; padding-top: 15px">' + pritem.SRNumber + '</td>'
															+ 	'<td style="padding-top: 15px">' + pritem.DistrictName + '</td>'
															+ 	'<td style="padding-top: 15px"><b>' + pritem.PickUpLocation + '</b></td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold; padding-top: 15px">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center; padding-top: 15px"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
												}
												else
												{
													tbl2Row = '<tr style="border-top: 1px solid #D5D5D6; font-size: 9pt">'
															+ 	'<td style="padding-left:20px; padding-top: 15px; padding-bottom:15px">' + pritem.SRNumber + '</td>'
															+ 	'<td style="padding-top: 15px; padding-bottom:15px">' + pritem.DistrictName + '</td>'
															+ 	'<td style="padding-top: 15px; padding-bottom:15px"><b>' + pritem.PickUpLocation + '</b></br>'  + pritem.BuildingNumber + ' ' + pritem.Street + '</br>' + pritem.CrossStreets + '</td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold; padding-top: 15px; padding-bottom:15px">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center; padding-top: 15px; padding-bottom:15px"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
												}
											}
											else
											{
												if(k == 1)
												{
													if(totalRows > 2)
													{
														tbl2Row = '<tr style="font-size: 9pt">'
																+ 	'<td style="padding-left:20px"></td>'
																+   '<td></td>'
																+ 	'<td>' + pritem.BuildingNumber + ' ' + pritem.Street + '</td>'
																+ 	tblCellCategory
																+ 	'<td style="text-align:Right; font-weight:bold;">' + pritemCat.RequestedQty  + '</td>'
																+ 	'<td style="text-align:center"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
																+ '</tr>'
													}
													else
													{
														tbl2Row = '<tr style="font-size: 9pt">'
															+ 	'<td style="padding-left:20px"></td>'
															+   '<td></td>'
															+ 	'<td>' + pritem.BuildingNumber + ' ' + pritem.Street + '</br>' + pritem.CrossStreets + '</td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold;">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
													}
												}
												else if(k == 2)
												{
													tbl2Row = '<tr style="font-size: 9pt">'
															+ 	'<td style="padding-left:20px"></td>'
															+   '<td></td>'
															+ 	'<td>' + pritem.CrossStreets + '</td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold;">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
												}
												else
												{
													if(k == (totalRows-1))
													{
														tbl2Row = '<tr style="font-size: 9pt">'
															+ 	'<td style="padding-left:20px; padding-bottom: 15px"></td>'
															+   '<td style="padding-bottom: 15px"></td>'
															+   '<td style="padding-bottom: 15px"></td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold; padding-bottom: 15px">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center; padding-bottom: 15px"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
													}
													else
													{
														tbl2Row = '<tr style="font-size: 9pt">'
															+ 	'<td style="padding-left:20px"></td>'
															+   '<td></td>'
															+   '<td></td>'
															+ 	tblCellCategory
															+ 	'<td style="text-align:Right; font-weight:bold;">' + pritemCat.RequestedQty  + '</td>'
															+ 	'<td style="text-align:center"><img src="/assets/dsny/dashboard/includes/img/PrintTaskCheckBox.png" alt="CheckboxIcon" style="width:25px;height:20px; padding:0px; margin-bottom:5px; margin-right:8px;" /></td>'
															+ '</tr>'
													}
												}
											}
											$('#tblrows'+ i).append(tbl2Row);
								});
						});
					});
					$('#tblReport').append('<tr style="height: 50px"> <td> </td> </tr>');
				}
        });

		$("#btnback").click(function () {
			window.location.href = "/assets/dsny/dashboard/index.shtml";
			return false;
		});

		$('.logoutButton').click(function () {
			sessionStorage.setItem("pickupdate", "");
			sessionStorage.setItem("borough", "");
			sessionStorage.setItem("district", "");
			window.location.href = '/assets/dsny/dashboard/login.shtml';
			return false;
		});
	});


	$("#btnprint").click(function(){
		$("#printlink").hide();
      	var originalContents = $("body").html();
      	var printContents = $("#divPrint").html();
      	$("body").html(printContents);
		window.print();
     	$("body").html(originalContents);
    });

	function getParameter(paramName) {
				var searchString = window.location.search.substring(1),
				i, val, params = searchString.split("&");
				for (i=0;i<params.length;i++) {
									val = params[i].split("=");
									if (val[0] == paramName) {
										return val[1];
									}
				}
			return null;
	}



    </script>
</body>

</html>
